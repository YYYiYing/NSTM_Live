<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>直播重定向</title>
    <link rel="preconnect" href="https://script.google.com">
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 100px; color: #333; }
    </style>
</head>
<body>
    <p>正在為您取得最新的網址...</p>
    <p>請稍候...</p>

    <script>
        // --- 設定區 ---
        const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzExvSQqP7Y-1Sn13TKtM2hkDKAko0RFjljva-Q6dp1uJaHGEngejUZxqeBUvvnOY5pkw/exec"; // 您的 GAS 網址
        const FALLBACK_URL = "https://mobile.nstm.gov.tw/";
        const TIMEOUT_SECONDS = 5; // 最多等 5 秒

        // --- 邏輯區 ---
        const controller = new AbortController();
        const timeoutId = setTimeout(() => {
            console.log('GAS timeout.');
            controller.abort(); // 中止 fetch
        }, TIMEOUT_SECONDS * 1000);

        function redirectTo(url) {
            window.location.href = url;
        }

        fetch(GAS_WEB_APP_URL, { signal: controller.signal })
            .then(response => response.text())
            .then(targetUrl => {
                clearTimeout(timeoutId); // 成功收到回應，取消計時

                if (targetUrl && (targetUrl.startsWith('http://') || targetUrl.startsWith('https://'))) {
                    // 成功：導向 A2 的網址
                    redirectTo(targetUrl);
                } else {
                    // 失敗：GAS 回傳 "INVALID_URL" 或 "GAS_ERROR"
                    console.log('Received invalid URL from GAS, redirecting to fallback.');
                    redirectTo(FALLBACK_URL);
                }
            })
            .catch(error => {
                // 失敗：網路錯誤或 5 秒逾時
                clearTimeout(timeoutId);
                console.error('Fetch error:', error.name);
                redirectTo(FALLBACK_URL);
            });
    </script>
</body>
</html>
